
/*BD Personas*/
create database if not exists bdPersonas;
use bdPersonas;

drop table if exists personas;
create table PERSONAS(
	NIF varchar(9) PRIMARY KEY,
	NSS VARCHAR (9) UNIQUE NOT NULL,
	NOMBRE varchar(25),
	APELLIDO VARCHAR(50),
	AñO_NACIMIENTO INT,
	FECHA_ALTA date,
	SALARIO INT,
	PUESTO ENUM('JEFE','OPERARIO','JUBILADO', 'LIMPIEZA'),
	FECHA_BAJA DATE DEFAULT NULL,
	SEDE_TRABAJA VARCHAR(2)
);

/*BD Personas*/
-- delete from personas where 1;

INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('74724714Z','25856985S','ALONSO','FERNANDEZ ROBLES', 1970, '2000-02-25',3520, 'JEFE', 'AB');
INSERT INTO PERSONAS VALUES('74725894Z','25858985S','LUIS','MARTINEZ ROBLES', 1981, '2000-10-20',1120, 'OPERARIO', '2020-11-06', 'AB');
INSERT INTO PERSONAS VALUES('74725898P','88888885S','LAURA','MARTIN ACEBEDO', 1982, '1999-10-05',1000, 'LIMPIEZA', '2009-12-06', 'AB');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('52563932O','32569885S','LARA','MARTOS GARCIA', 1998, '2010-05-02',1120, 'OPERARIO', 'AB');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('74895951A','89568956E','ANA','RUIZ GARCIA', 1980, '2010-02-05',1000, 'LIMPIEZA', 'AB');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
VALUES('89898989D','96969696R','AMAYA','MARIN AVILA', 1971, '1998-05-02',1420, 'OPERARIO', 'AB');
INSERT INTO PERSONAS VALUES('12121212O','56565656Y','CESAR','SAMAPYO PEREZ', 1978, '2009-05-02',900, 'JUBILADO', '2020-10-06', 'AB');
INSERT INTO PERSONAS VALUES('58585858Z','28484844S','PILAR','AGUERO TOLOSA', 1960, '2000-05-02',850, 'JUBILADO', '2020-11-02', 'AB');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('74663363D','20000010S','VANESA','MARTIN SANZA', 1985, '2000-05-12',1150, 'OPERARIO','AB');

INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('7472471PZ','25856944S','ALONSO','FERNANDEZ ROBLES', 1970, '2000-02-25',3520, 'JEFE', 'AC');
INSERT INTO PERSONAS VALUES('74725894L','25858985P','LEO','MARTIN PEREZ', 1981, '2000-10-20',1120, 'OPERARIO', '2020-11-06', 'AC');
INSERT INTO PERSONAS VALUES('74725898T','8888888K','LALI','MARTINEZ ACENA', 1982, '1999-10-05',1000, 'LIMPIEZA', '2009-12-06', 'AC');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('52563932N','32569885M','JOSE','MARIN GIO', 1998, '2010-05-02',1120, 'OPERARIO', 'AC');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('74895951T','89568956Y','LIO','RUTA GOLA', 1980, '2010-02-05',1000, 'LIMPIEZA', 'AC');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
VALUES('89898989J','96969696A','AMADA','GARAYOA SOLDADO', 1971, '1998-05-02',1420, 'OPERARIO', 'AC');
INSERT INTO PERSONAS VALUES('12121212Q','56565656T','CAMILO','SAMUEL PAZO', 1978, '2009-05-02',900, 'JUBILADO', '2020-10-06', 'AC');
INSERT INTO PERSONAS VALUES('5858585J','28484844G','PEDRO','AGUILAS REDONDEO', 1960, '2000-05-02',850, 'JUBILADO', '2020-11-02', 'AC');
INSERT INTO PERSONAS (NIF,NSS,NOMBRE, APELLIDO, AñO_NACIMIENTO,FECHA_ALTA, SALARIO, PUESTO, SEDE_TRABAJA) 
	VALUES('74663363Z','20000010D','VALERIA','ALBORAN LOPEZ', 1985, '2000-05-12',1150, 'OPERARIO','AC');


select *
	from personas;
/*
select upper(nombre), fecha_alta, now(), timestampdiff(year, fecha_alta, "2020-06-01") as "antiguedad"
	from personas;

select apellido, nombre
	from personas
    where sede_trabaja = "AB"
    order by nombre;    

select año_nacimiento, nombre
	from personas
    where sede_trabaja = "AC" and puesto = "JUBILADO"
    order by año_nacimiento
    limit 1;

select min(año_nacimiento)
	from personas
    where sede_trabaja = "AC" and puesto = "JUBILADO";

select count(distinct puesto), sede_trabaja
	from personas
    group by sede_trabaja;
*/
select puesto, avg(salario) as "media"
	from personas
    group by puesto
    having avg(salario) between 800 and 1200;

select year(fecha_alta), año_nacimiento, count(*)
	from personas
    where año_nacimiento > 1980
    group by year(fecha_alta)
    having count(*) >= 2;
